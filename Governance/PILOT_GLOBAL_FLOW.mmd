%% ========================================
%% ArchPilot Core ÂÖ®Â±Ä Pilot ÊµÅÁ®ãÂõæ
%% ËßíËâ≤ÔºöÁ≥ªÁªüÊû∂ÊûÑÂ∏à / ËΩØ‰ª∂Êû∂ÊûÑÂ∑•Á®ãÂ∏à
%% ËØ¥ÊòéÔºöÂ±ïÁ§∫Â¶Ç‰Ωï‰ΩøÁî®Êï¥‰∏™Â∑•Á®ãÁöÑÊñáÊ°£ËµÑ‰∫ßÊé®ËøõÈ°πÁõÆËø≠‰ª£
%% ========================================

flowchart TB
    %% ==================== ËßíËâ≤ÂÖ•Âè£ ====================
    subgraph Role["üë§ Á≥ªÁªü/ËΩØ‰ª∂Êû∂ÊûÑÂ∑•Á®ãÂ∏à"]
        direction LR
        R1["üèõÔ∏è Êû∂ÊûÑËÆæËÆ°"] ~~~ R2["üíª ÂºÄÂèëÊåáÂØº"] ~~~ R3["üîç Ë¥®ÈáèÊääÊéß"] ~~~ R4["üöÄ ÁâàÊú¨ÂèëÂ∏É"]
    end

    %% ==================== Âõæ‰æãÔºàÊñáÊ°£Áª¥Â∫¶È¢úËâ≤Ôºâ ====================
    subgraph Legend["üìö ÊñáÊ°£Áª¥Â∫¶"]
        direction LR
        L1[/"Entry ÂÖ•Âè£"/]
        L2[/"Rules ËßÑÂàô"/]
        L3[/"Workflow Â∑•‰ΩúÊµÅ"/]
        L4[/"Templates Ê®°Êùø"/]
        L5[/"Scripts ËÑöÊú¨"/]
        L6[/"Output ‰∫ßÂá∫"/]
        L1 ~~~ L2 ~~~ L3 ~~~ L4 ~~~ L5 ~~~ L6
    end

    %% ==================== Pilot Ëø≠‰ª£Âë®ÊúüÔºàÊ†∏ÂøÉÔºâ ====================
    subgraph Phases["üìÖ Pilot Ëø≠‰ª£Âë®Êúü"]
        direction LR

        subgraph P1["Gate1 ÂêØÂä®"]
            direction TB
            P1_S["‚ë† ÁêÜËß£Ê°ÜÊû∂"]
            P1_D1[/"README"/]
            P1_D2[/"QUICK_START"/]
            P1_M["‚ë° ÈÉ®ÁΩ≤È°πÁõÆ"]
            P1_D3[/"deploy_project.sh"/]
            P1_E["‚ë¢ ËßÑÂàíËø≠‰ª£"]
            P1_D4[/"flow_planning"/]
            P1_S --- P1_D1 & P1_D2
            P1_D1 & P1_D2 --- P1_M
            P1_M --- P1_D3
            P1_D3 --- P1_E
            P1_E --- P1_D4
        end

        subgraph P2["Gate2 ËÆæËÆ°"]
            direction TB
            P2_S["‚ë† L1 ÈúÄÊ±Ç"]
            P2_D1[/"ARCHITECTURE_DEF"/]
            P2_D2[/"requirement_tpl"/]
            P2_M["‚ë° L2 Êû∂ÊûÑ"]
            P2_D3[/"architecture_tpl"/]
            P2_E["‚ë¢ L3 ËÆæËÆ°"]
            P2_D4[/"design_tpl"/]
            P2_D5[/"rules_naming"/]
            P2_S --- P2_D1 & P2_D2
            P2_D1 & P2_D2 --- P2_M
            P2_M --- P2_D3
            P2_D3 --- P2_E
            P2_E --- P2_D4 & P2_D5
        end

        subgraph P3["Gate3 ÂÆûÁé∞"]
            direction TB
            P3_S["‚ë† L4 ‰ª£Á†Å"]
            P3_D1[/"rules_coding"/]
            P3_D2[/"flow_implement"/]
            P3_M["‚ë° L5 ÊµãËØï"]
            P3_D3[/"testcase_tpl"/]
            P3_E["‚ë¢ Ë¥®ÈáèÊ£ÄÊü•"]
            P3_D4[/"validate_trace.py"/]
            P3_D5[/"check_naming.py"/]
            P3_S --- P3_D1 & P3_D2
            P3_D1 & P3_D2 --- P3_M
            P3_M --- P3_D3
            P3_D3 --- P3_E
            P3_E --- P3_D4 & P3_D5
        end

        subgraph P4["Gate4 ÂèëÂ∏É"]
            direction TB
            P4_S["‚ë† ÁâàÊú¨ÂèëÂ∏É"]
            P4_D1[/"rules_release"/]
            P4_D2[/"flow_release"/]
            P4_M["‚ë° È™åÊî∂Èó≠ÁéØ"]
            P4_D3[/"calculate_score.py"/]
            P4_E["‚ë¢ Ëø≠‰ª£Â§çÁõò"]
            P4_D4[/"ReleaseNote"/]
            P4_S --- P4_D1 & P4_D2
            P4_D1 & P4_D2 --- P4_M
            P4_M --- P4_D3
            P4_D3 --- P4_E
            P4_E --- P4_D4
        end

        P1 ==> P2 ==> P3 ==> P4
    end

    %% Ëø≠‰ª£Èó≠ÁéØ
    P4 -.->|üîÑ ‰∏ã‰∏ÄËø≠‰ª£| P1

    %% ==================== AI Pilot Âçè‰ΩúÔºàÂ∫ïÈÉ®Ôºâ ====================
    subgraph AI_Pilot["ü§ñ AI Pilot Âçè‰Ωú"]
        direction LR
        AI_IN["Agents/ + Prompts/"] --> AI_PROC["System + User Prompt"] --> AI_OUT["AIÊâßË°å ‚Üí ‰∫∫Â∑•Á°ÆËÆ§"]
    end

    %% ==================== Â±ÇÁ∫ßËøûÊé• ====================
    Role --> Legend
    Legend --> Phases
    Phases --> AI_Pilot

    %% ==================== Ê†∑ÂºèÂÆö‰πâ ====================
    %% Ê°ÜÊû∂Ê†∑Âºè
    classDef roleStyle fill:#e3f2fd,stroke:#1565c0,stroke-width:3px,color:#000
    classDef phaseStyle fill:#fafafa,stroke:#616161,stroke-width:2px,color:#000
    classDef aiStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef legendStyle fill:#fafafa,stroke:#bdbdbd,stroke-width:1px,color:#000
    classDef stepStyle fill:#fff,stroke:#616161,stroke-width:2px,color:#000

    %% ÊñáÊ°£Áª¥Â∫¶È¢úËâ≤
    classDef entryStyle fill:#ffcdd2,stroke:#c62828,stroke-width:2px,color:#000
    classDef ruleStyle fill:#fff9c4,stroke:#f57f17,stroke-width:2px,color:#000
    classDef workflowStyle fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px,color:#000
    classDef tplStyle fill:#bbdefb,stroke:#1565c0,stroke-width:2px,color:#000
    classDef scriptStyle fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef outputStyle fill:#ffe0b2,stroke:#ef6c00,stroke-width:2px,color:#000

    %% Â∫îÁî®Ê†∑Âºè
    class Role roleStyle
    class Phases,P1,P2,P3,P4 phaseStyle
    class AI_Pilot aiStyle
    class Legend legendStyle
    class P1_S,P1_M,P1_E,P2_S,P2_M,P2_E,P3_S,P3_M,P3_E,P4_S,P4_M,P4_E stepStyle

    %% Âõæ‰æãÈ¢úËâ≤
    class L1 entryStyle
    class L2 ruleStyle
    class L3 workflowStyle
    class L4 tplStyle
    class L5 scriptStyle
    class L6 outputStyle

    %% Gate1: Entry(Á∫¢) + Scripts(Á¥´) + Workflow(Áªø)
    class P1_D1,P1_D2 entryStyle
    class P1_D3 scriptStyle
    class P1_D4 workflowStyle

    %% Gate2: Entry(Á∫¢) + Templates(Ëìù) + Rules(ÈªÑ)
    class P2_D1 entryStyle
    class P2_D2,P2_D3,P2_D4 tplStyle
    class P2_D5 ruleStyle

    %% Gate3: Rules(ÈªÑ) + Workflow(Áªø) + Templates(Ëìù) + Scripts(Á¥´)
    class P3_D1 ruleStyle
    class P3_D2 workflowStyle
    class P3_D3 tplStyle
    class P3_D4,P3_D5 scriptStyle

    %% Gate4: Rules(ÈªÑ) + Workflow(Áªø) + Scripts(Á¥´) + Output(Ê©ô)
    class P4_D1 ruleStyle
    class P4_D2 workflowStyle
    class P4_D3 scriptStyle
    class P4_D4 outputStyle
