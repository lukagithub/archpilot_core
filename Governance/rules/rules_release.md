# 发布管理规则

**文档版本**: v1.0.0  
**最后更新**: 2026-02-01  
**适用范围**: 项目版本发布全流程

> 本文档定义了版本号规范、发布流程、质量评分体系和发布决策规则。

---

## 1. 版本号规范

### 1.1 语义化版本

**格式**: `MAJOR.MINOR.PATCH[-标识符][+构建信息]`

| 组成部分 | 含义 | 递增条件 |
|----------|------|----------|
| MAJOR | 主版本号 | 不兼容的 API 变更、架构重大变更 |
| MINOR | 次版本号 | 向下兼容的功能新增 |
| PATCH | 修订号 | 向下兼容的问题修复 |
| 标识符 | 预发布标识 | alpha、beta、rc |
| 构建信息 | 构建元数据 | 构建号、日期等 |

### 1.2 预发布标识

| 标识符 | 含义 | 质量要求 |
|--------|------|----------|
| alpha | 内部测试版 | 基本功能完成 |
| beta | 公测版 | 主要功能稳定 |
| rc | 候选发布版 | 准生产质量 |

**示例**:
- `v1.2.3` - 正式版本
- `v2.0.0-alpha.1` - Alpha 版本
- `v2.0.0-beta.2` - Beta 版本
- `v2.0.0-rc.1` - RC 版本

### 1.3 版本递增决策

```
开始
  ├─ 是否存在 BREAKING CHANGE / 架构层变更？
  │      └─ 是 → MAJOR++
  ├─ 是否有新增功能或 feat: 提交？
  │      └─ 是 → MINOR++
  ├─ 是否有 fix:/docs:/test: 类型提交？
  │      └─ 是 → PATCH++
  └─ 否则 → PATCH++
```

---

## 2. Git Tag 规范

### 2.1 Tag 命名

| 类型 | 格式 | 示例 |
|------|------|------|
| 正式版本 | `vX.Y.Z` | `v1.2.3` |
| 预发布版 | `vX.Y.Z-标识符.序号` | `v2.0.0-beta.1` |
| 开发快照 | `snapshot/分支-日期` | `snapshot/main-20260201` |

### 2.2 Tag 注释内容

✅ **必须包含**:
- 标题行: `Release v{VERSION}: {简短标题}`（≤80字符）
- 主要变更: 2-5 行
- 关键特性: 3-8 项

❌ **禁止**:
- 仅使用 `Release vX.Y.Z` 作为全部内容
- 缺少关键特性列表

**标准格式**:
```
Release v{VERSION}: {简短标题}

🚀 主要变更
- {变更1}
- {变更2}

📦 关键特性:
- {特性1}
- {特性2}
- {特性3}

🧪 测试状态:
- 单元测试: {覆盖率}%
- 集成测试: {状态}

✅ 状态: {发布状态说明}
```

---

## 3. 发布流程

### 3.1 阶段概览

```
Phase 1: 开发完成
  ├─ 所有功能实现
  ├─ 代码审查通过
  └─ 单元测试通过
      ↓
Phase 2: 集成测试
  ├─ 集成测试通过
  ├─ 性能测试达标
  └─ 安全扫描通过
      ↓
Phase 3: 发布准备
  ├─ 更新版本号
  ├─ 编写 ReleaseNote
  └─ 执行质量评分
      ↓
Phase 4: 正式发布
  ├─ 创建 Git Tag
  ├─ 构建发布包
  └─ 发布通知
```

### 3.2 质量门禁

每个阶段必须通过质量检查才能进入下一阶段：

| 阶段 | 门禁检查 |
|------|----------|
| Phase 1 → Phase 2 | 单元测试通过率 ≥ 90% |
| Phase 2 → Phase 3 | 集成测试全部通过 |
| Phase 3 → Phase 4 | 质量评分达标 |

---

## 4. 质量评分体系

### 4.1 五维度评分模型

| 维度 | 权重 | 满分 | 评估内容 |
|------|------|------|----------|
| D1: 文档完整性 | 20% | 5分 | L1-L3 文档的完整性和规范性 |
| D2: 追溯关系 | 15% | 5分 | L1-L5 层级间追溯链完整性 |
| D3: 功能实现 | 30% | 5分 | L4 功能实现完整度和质量 |
| D4: 测试验证 | 25% | 5分 | L5 测试覆盖率和质量 |
| D5: 代码质量 | 10% | 5分 | 代码规范、静态分析、复杂度 |

### 4.2 加权总分计算

```
加权总分 = D1×0.2 + D2×0.15 + D3×0.3 + D4×0.25 + D5×0.1
```

### 4.3 详细评分标准

#### D1: 文档完整性（20%）

| 分数 | 标准 |
|------|------|
| 5.0 | 所有必需文档存在且内容完整规范 |
| 4.0 | 核心文档完整，少量非核心文档缺失 |
| 3.0 | 主要文档存在，部分内容不完整 |
| 2.0 | 文档缺失较多或内容严重不完整 |
| 1.0 | 缺少大部分必需文档 |

#### D2: 追溯关系（15%）

| 分数 | 标准 |
|------|------|
| 5.0 | L1-L5 追溯链 100% 完整，无断裂 |
| 4.0 | 追溯链完整度 ≥ 90% |
| 3.0 | 追溯链完整度 ≥ 70% |
| 2.0 | 追溯链完整度 ≥ 50% |
| 1.0 | 追溯链完整度 < 50% |

#### D3: 功能实现（30%）

| 分数 | 标准 |
|------|------|
| 5.0 | 所有计划功能实现，代码质量优秀 |
| 4.0 | 核心功能完成，代码质量良好 |
| 3.0 | 主要功能完成，存在非阻断问题 |
| 2.0 | 部分功能未完成或存在较多问题 |
| 1.0 | 关键功能未完成 |

#### D4: 测试验证（25%）

| 分数 | 标准 |
|------|------|
| 5.0 | 测试覆盖率 ≥ 85%，全部用例通过 |
| 4.0 | 测试覆盖率 ≥ 70%，核心用例通过 |
| 3.0 | 测试覆盖率 ≥ 50%，主要用例通过 |
| 2.0 | 测试覆盖率 ≥ 30%，存在失败用例 |
| 1.0 | 测试覆盖率 < 30% 或大量失败 |

#### D5: 代码质量（10%）

| 分数 | 标准 |
|------|------|
| 5.0 | 无静态分析问题，复杂度达标 |
| 4.0 | 仅有少量低优先级警告 |
| 3.0 | 存在中等数量警告，无严重问题 |
| 2.0 | 存在较多警告或少量严重问题 |
| 1.0 | 存在大量严重问题 |

---

## 5. 发布决策矩阵

| 加权总分 | 质量评级 | 发布类型 | 决策 |
|---------|---------|----------|------|
| ≥4.5分 | 优秀 | 正式版本 | ✅ 推荐发布 |
| ≥4.0分 | 良好 | 正式版本 | ✅ 可以发布 |
| ≥3.0分 | 及格 | Beta/RC | ⚠️ 有条件发布 |
| ≥2.0分 | 较差 | Alpha | ⚠️ 仅限内部测试 |
| <2.0分 | 不及格 | - | ❌ 禁止发布 |

**决策规则**:
- 任意维度得分 < 2.0 → 触发阻断，需人工评审
- 加权总分达标但单项不达标 → 记录风险，允许发布
- AI 执行时必须严格遵循决策矩阵

---

## 6. ReleaseNote 规范

### 6.1 基本结构

```markdown
# 项目名称 vX.Y.Z Release Notes

## 概述
- **版本**: vX.Y.Z
- **发布日期**: YYYY-MM-DD
- **发布类型**: Major/Minor/Patch
- **兼容性**: 向后兼容说明

## 新功能
- [新增] 功能描述

## Bug 修复
- [修复] 问题描述

## 性能优化
- [优化] 优化项

## 技术变更
- API 变更
- 配置变更
- 依赖更新

## 升级指南
升级步骤说明

## 已知问题
- 问题描述及临时解决方案
```

### 6.2 内容要求

- ✅ 版本信息完整准确
- ✅ 变更内容分类清晰
- ✅ 关联的 Issue/PR 编号
- ✅ 升级影响说明
- ⚠️ 建议包含示例代码（如有 API 变更）

---

## 7. 发布报告规范

发布报告用于记录版本质量评估结果：

```markdown
# 项目名称 vX.Y.Z 发布成果报告

**报告日期**: YYYY-MM-DD  
**评分依据**: 本文档第4节（五维度5分制）

## 质量评分结论

| 维度 | 得分 | 权重 | 加权得分 | 状态 |
|------|------|------|----------|------|
| D1: 文档完整性 | X.X | 20% | X.XX | ✅/⚠️/❌ |
| D2: 追溯关系 | X.X | 15% | X.XX | ✅/⚠️/❌ |
| D3: 功能实现 | X.X | 30% | X.XX | ✅/⚠️/❌ |
| D4: 测试验证 | X.X | 25% | X.XX | ✅/⚠️/❌ |
| D5: 代码质量 | X.X | 10% | X.XX | ✅/⚠️/❌ |
| **加权总分** | - | 100% | **X.XX** | - |

**质量评级**: 优秀/良好/及格/不及格  
**发布建议**: ✅ 推荐发布 / ⚠️ 有条件发布 / ❌ 不建议发布

## 详细评分分析
[各维度详细说明]

## 改进建议
[后续改进方向]
```

---

## 8. 分支策略

### 8.1 单主干模式（推荐）

- 所有开发与发布使用 **main** 分支
- 禁止创建和保留长期分支
- 远端仅保留 main 分支

### 8.2 分支规则

| 分支类型 | 生命周期 | 说明 |
|----------|----------|------|
| main | 永久 | 唯一的主干分支 |
| feature/* | 短期 | 合并后删除 |
| hotfix/* | 短期 | 合并后删除 |

---

## 9. 关联文档

- `ARCHITECTURE_DEFINITION.md` - 架构权威定义
- `rules_tag.md` - Git Tag 详细规范
- `rules_scripts.md` - 脚本执行规范
- `../checklists/release_checklist.md` - 发布检查清单
- `../Guides/AI_Release_Automation_Guide.md` - AI 发布自动化指南

