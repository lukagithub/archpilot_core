# ArchPilot Core - AI 架构设计指南

**版本**: v1.0.0  
**最后更新**: 2026-02-01  
**目标**: 为架构师提供与 AI 协作进行架构设计的实用指南和提示模板

---

## 一、核心原则

### 1.1 AI 工作模式

基于本框架的 AI 助手遵循**文档驱动**和**规则约束**的工作模式：

1. **权威文档优先**: AI 以 `Governance/` 目录下的规则文档为最高依据
2. **自动化执行**: AI 优先使用现有脚本和工具
3. **质量门禁**: AI 严格遵循质量评分体系
4. **错误处理**: AI 在遇到异常时请求人工介入

### 1.2 开发者与 AI 协作流程

```
开发者 → 提供明确任务和上下文
   ↓
AI → 读取相关规则文档
   ↓
AI → 执行自动化检查/开发/测试
   ↓
AI → 生成报告或请求人工确认
   ↓
开发者 → 审核结果并决策
```

---

## 二、AI 提示词库

### 2.1 规则理解类

#### 提示模板：理解项目规则

```
请阅读 Governance/ 目录下的规则文件，理解本项目的开发规范。

请按以下顺序阅读：
1. GOVERNANCE_OVERVIEW.md - 了解治理体系
2. ARCHITECTURE_DEFINITION.md - 理解 L1-L5 架构
3. GLOSSARY.md - 熟悉术语标准

阅读后，请总结：
- 项目采用的五层架构是什么
- AI 操作需要遵循的主要规则
- 哪些文件受变更保护
```

### 2.2 设计验证类

#### 提示模板：检查 L1-L5 追溯完整性

```
请检查当前项目的 L1-L5 追溯完整性。

请执行以下步骤：
1. 读取 ARCHITECTURE_DEFINITION.md 理解五层架构定义
2. 检查各层级文档是否存在
3. 验证追溯关系：
   - L1 需求 → L2 架构 是否建立
   - L2 架构 → L3 设计 是否建立
   - L3 设计 → L4 实现 是否建立
   - L4 实现 → L5 测试 是否建立
4. 生成检查报告

请输出：
- 总体追溯完整性百分比
- 各层级问题清单
- 修复优先级建议
```

#### 提示模板：验证新功能设计一致性

```
请验证新功能 "{功能名称}" 的设计是否与现有架构一致。

请检查：
1. 相关需求文档：FR_xxx_xxx.md
2. 架构设计：对应的 SA 文档
3. 详细设计：对应的 DD 文档
4. 实现代码
5. 测试用例

验证要点：
- 功能命名是否符合 rules_naming.md 规范
- 接口设计是否与 L2 架构一致
- 实现是否遵循 L3 详细设计
- 测试是否覆盖所有需求场景

请输出验证结果和建议。
```

### 2.3 开发实现类

#### 提示模板：基于 L1 需求实现功能

```
请基于 L1 需求文档 FR_xxx_xxx.md 实现功能。

实现要求：
1. 遵循 rules_coding.md 中的编码规范
2. 在代码文件头部添加追溯注释（@requirement, @design）
3. 使用标准的错误处理和日志
4. 实现后更新追溯关系

具体任务：
1. 阅读需求文档理解功能目标
2. 检查是否有对应的 L2/L3 设计文档
3. 创建实现代码
4. 添加追溯注释
5. 编写基本测试

请分步骤执行，每步输出进度。
```

#### 提示模板：修复 Bug

```
请修复问题：{问题描述}

分析步骤：
1. 定位相关代码
2. 分析问题原因
3. 确定修复方案

修复要求：
1. 确保不引入新问题
2. 保持接口兼容
3. 添加回归测试
4. 更新相关文档（如有）

请提供：
1. 问题分析报告
2. 修复方案
3. 修改后的代码
4. 测试验证结果
```

### 2.4 测试与质量类

#### 提示模板：编写 L5 测试用例

```
请为 "{功能名称}" 编写 L5 测试用例。

测试要求：
1. 遵循 rules_testcases.md 命名规范
2. 文件名格式：TC_[subsystem]_[id]_[type]_[desc].md
3. 包含完整的 YAML 元数据
4. traces_from 引用被测的 L1 需求

测试场景：
1. 基础功能测试
2. 边界条件测试
3. 异常处理测试
4. 性能测试（如适用）

请输出：
1. 测试用例设计
2. 测试代码实现
3. 预期结果
```

#### 提示模板：计算质量评分

```
请计算当前版本的质量评分。

评分维度（参考 rules_release.md 第4节）：
- D1: 文档完整性（20%）
- D2: 追溯关系（15%）
- D3: 功能实现（30%）
- D4: 测试验证（25%）
- D5: 代码质量（10%）

执行步骤：
1. 检查各层级文档完整性
2. 验证追溯链完整性
3. 评估功能实现状态
4. 检查测试覆盖率
5. 分析代码质量

请输出：
1. 各维度详细得分（0-5分）
2. 加权总分
3. 质量评级
4. 发布建议
5. 改进建议（如不达标）
```

### 2.5 发布管理类

#### 提示模板：执行版本发布

```
请执行版本发布流程。

发布步骤：
1. 确定版本号（分析 commit 类型）
2. 运行 L1-L5 一致性检查
3. 执行质量评分
4. 基于评分做发布决策
5. 更新版本号
6. 生成 ReleaseNote
7. 生成发布报告
8. 创建 Git Tag

请按照 rules_release.md 执行，每步输出结果。
```

#### 提示模板：创建 Git Tag

```
请为版本 v{VERSION} 创建 Git Tag。

要求（参考 rules_tag.md）：
1. 标题行 ≤80 字符
2. 包含主要变更（2-5行）
3. 包含关键特性（3-8项）
4. 包含测试状态
5. 使用适当的 emoji

禁止：
- 仅使用 "Release vX.Y.Z" 作为全部内容
- 缺少关键特性列表

请生成 Tag 内容并创建。
```

---

## 三、常用工作流

### 3.1 新功能开发流程

```
1. 需求澄清
   └─ 提示：请帮我理解需求文档 FR_xxx.md 的内容

2. 设计评审
   └─ 提示：请检查 SA_xxx.md 和 DD_xxx.md 是否与需求一致

3. 代码实现
   └─ 提示：基于 DD_xxx.md 实现功能，遵循编码规范

4. 测试编写
   └─ 提示：为实现的功能编写测试用例

5. 追溯验证
   └─ 提示：检查新增内容的追溯关系是否完整
```

### 3.2 Bug 修复流程

```
1. 问题定位
   └─ 提示：帮我分析问题 {描述} 的可能原因

2. 修复实现
   └─ 提示：修复问题并确保不引入新问题

3. 回归测试
   └─ 提示：添加回归测试用例

4. 文档更新
   └─ 提示：检查是否需要更新相关文档
```

### 3.3 版本发布流程

```
1. 质量检查
   └─ 提示：检查 L1-L5 追溯完整性

2. 质量评分
   └─ 提示：计算当前版本的五维度质量评分

3. 发布准备
   └─ 提示：生成 ReleaseNote 和发布报告

4. Tag 创建
   └─ 提示：创建符合规范的 Git Tag

5. 发布验证
   └─ 提示：验证发布是否成功完成
```

---

## 四、注意事项

### 4.1 变更保护

受保护的文件头部有 AI 变更保护声明：
```markdown
> **⚠️ AI 变更保护声明**
> ...
```

遇到受保护文件时：
1. AI 会输出变更理由
2. 需要你确认后才能修改
3. 可以授权当前会话的修改

### 4.2 规则冲突

当 AI 报告规则冲突时：
1. 查看冲突的具体规则
2. 确认优先级（上层规则 > 下层规则）
3. 必要时更新规则文档

### 4.3 评分不达标

当质量评分不达标时：
1. 查看哪个维度得分低
2. 按照 AI 的改进建议操作
3. 修复后重新评分

---

## 五、关联文档

- [治理总览](../Governance/GOVERNANCE_OVERVIEW.md)
- [架构定义](../Governance/ARCHITECTURE_DEFINITION.md)
- [Agent 使用说明](../Agents/README.md)
- [发布自动化指南](AI_Release_Automation_Guide.md)

